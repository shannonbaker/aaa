<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Image Manipulation</title>
</head>
<body>
    <input type="file" id="imageInput" accept="image/*">
    <input type="file" id="replacementInput" accept="image/*">
    <canvas id="canvas" width="400" height="400"></canvas>
    <button id="manipulateButton">Grayscale & Resize</button>
    <button id="replaceButton">Replace Region</button>
    <button id="saveButton" disabled>Save File</button>

    <script>
        // Variables to store the selected region and replacement image
        let selectedRegion = null;
        let replacementImage = null;

        // Function to manipulate the image (in this case, grayscale)
        function grayscaleImage(context, width, height) {
            const imageData = context.getImageData(0, 0, width, height);
            const data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                const red = data[i];
                const green = data[i + 1];
                const blue = data[i + 2];

                // Convert the pixel to grayscale
                const grayscale = 0.299 * red + 0.587 * green + 0.114 * blue;

                data[i] = data[i + 1] = data[i + 2] = grayscale;
            }

            context.putImageData(imageData, 0, 0);
        }

        // Function to resize the image to 2/3 of its original size
        function resizeImage(context, width, height, scaleFactor) {
            const canvas = document.createElement('canvas');
            const newWidth = width * scaleFactor;
            const newHeight = height * scaleFactor;

            canvas.width = newWidth;
            canvas.height = newHeight;

            const newContext = canvas.getContext('2d');
            newContext.drawImage(context.canvas, 0, 0, width, height, 0, 0, newWidth, newHeight);

            context.canvas.width = newWidth;
            context.canvas.height = newHeight;
            context.drawImage(canvas, 0, 0, newWidth, newHeight);
        }

        // Function to replace a selected region with the replacement image
        function replaceRegion(context, selectedRegion, replacementImage) {
            if (!selectedRegion || !replacementImage) {
                return;
            }

            context.drawImage(replacementImage, selectedRegion.x, selectedRegion.y, selectedRegion.width, selectedRegion.height);
        }

        // Handle image upload and manipulation
        document.getElementById('imageInput').addEventListener('change', function (event) {
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');
            const image = new Image();

            image.onload = function () {
                canvas.width = image.width;
                canvas.height = image.height;
                context.drawImage(image, 0, 0);
                document.getElementById('saveButton').disabled = false;
            };

            image.src = URL.createObjectURL(event.target.files[0]);
        });

        // Handle replacement image upload
        document.getElementById('replacementInput').addEventListener('change', function (event) {
            const image = new Image();

            image.onload = function () {
                replacementImage = image;
            };

            image.src = URL.createObjectURL(event.target.files[0]);
        });

        // Handle manipulation button click
        document.getElementById('manipulateButton').addEventListener('click', function () {
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            grayscaleImage(context, width, height);
            resizeImage(context, width, height, 2/3);
        });

        // Handle replace button click
        document.getElementById('replaceButton').addEventListener('click', function () {
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');

            const x = parseInt(prompt('Enter X-coordinate of the region to replace', '0'));
            const y = parseInt(prompt('Enter Y-coordinate of the region to replace', '0'));
            const width = parseInt(prompt('Enter width of the region to replace', '100'));
            const height = parseInt(prompt('Enter height of the region to replace', '100'));

            selectedRegion = { x, y, width, height };

            replaceRegion(context, selectedRegion, replacementImage);
        });

        // Handle save button click
        document.getElementById('saveButton').addEventListener('click', function () {
            const canvas = document.getElementById('canvas');
            canvas.toBlob(function (blob) {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'altered_image.png';
                link.click();
            });
        });
    </script>
</body>
</html>
